---
description: python testing
alwaysApply: false
globs:
  - "**/*.{py,pyi}"
---

# Python Testing

## Default stack
- Prefer **pytest**.
- Use fixtures for setup/teardown; avoid global mutable test state.

## What to test
- Pure functions: happy path + edge cases.
- I/O boundaries: mock external services (network, S3, DB) unless doing explicit integration tests.
- Validate error handling (exceptions, invalid inputs).

## Patterns
- Use `parametrize` for matrix-style tests.
- Prefer time-freezing or dependency injection rather than `sleep`.
- Keep tests deterministic: no random without a seed.

## Running
- Fast path: `pytest -q`.
- If type checking is enabled, keep annotations consistent and add minimal stubs for tricky mocks.