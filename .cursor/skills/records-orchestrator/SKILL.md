---
name: records-orchestrator
description: records/ をSSOTにして Unit of Work を切り、Codex依頼書・進捗・引き継ぎを一貫運用するための手順/規約。
---

# records-orchestrator（SSOT運用スキル）

このスキルは、**「ファイル指定ミス」「進捗の迷子」「モデル間の文脈欠落」**を減らすために、
records/ を Single Source of Truth（SSOT）として扱いながら、Unit of Work を安定運用するための手順です。

---

## いつ使うか

- `records/` が増えてきて、どれが正か迷うとき
- 「計画 → 実装依頼 → 検証 → コミット」を **毎回同じ型**で回したいとき
- Codex 依頼書（md）を作るたびに、ファイルパス指定で事故が起きるとき
- モデルを跨いで作業し、コンテキストが痩せて品質が落ちるとき

---

## ゴールデンパス（推奨の最短手順）

### 1) SSOT確認（必須）

- `@records/<project>/status.md`
- `@records/<project>/*implementation_plan*.md`
- `@records/<project>/decisions/`（重要な判断がある場合）

**迷ったら status → plan の順に戻る。**

### 2) Unit of Work を 1つに絞る

UoW の良い粒度:

- 受け入れ条件（DoD）を 5〜10 個で書ける
- 変更ファイルが 3〜8 個程度で済む
- テストを追加できる（または既存テストで検証できる）
- 1回の依頼で「完了」まで持っていける

### 3) Codex依頼書を生成（スクリプト推奨）

```bash
python .cursor/scripts/ops.py codex-request --task-id <TASK_ID> --title "<TITLE>"
# または
python .cursor/scripts/ops.py uow
```

### 4) 依頼書の必須項目を埋める

- 目的 / 非目的（ここが最重要）
- 対象ファイル（編集OK / 参照）
- 実装タスク（手順）
- DoD（チェックリスト）
- テスト方針
- 制約（シェル実行、依存追加、ネットワーク、危険操作）

### 5) 監査（推奨）

- `@request-auditor` を呼び、依頼書の抜け漏れ/矛盾を潰す

### 6) 実装委任 → 司令塔が検証

- 実装担当（Codex CLI 等）に依頼書を渡す
- 戻りをレビューし、ローカルでテスト
- 必要なら追依頼（差分が小さくなるように）

### 7) records を更新してからコミット

- status: Now→Done、Next の補充
- decisions: 重要な判断を記録
- handover: スレッド移行が近いなら更新

---

## モデル運用の「減速」対策（多角的レビュー観点）

> このセクションは恒久運用のための観点です。モデル名は入れ替えても成立します。

- **計画のSSOTを固定**: 「plan.md を唯一の真実」にする。別スレッドの議論は decisions/handover に要約してリンク。
- **レビューはチェックリスト化**: モデルが変わっても、同じ観点でレビューできる形にする（DoD / テスト観点 / セキュリティ観点）。
- **実装担当には“自由”を渡しすぎない**: 非目的・制約・対象ファイルを明示し、スコープ肥大を防ぐ。
- **手戻りを最小化**: UoWを小さく切り、テストで閉じる。
- **コンテキスト枯渇前に handover**: 会話が長くなったら先に引き継ぎを書く（次スレッドで再現可能にする）。

---

## よくある事故と防止策

- 事故: 間違ったファイルに書く  
  対策: `ops.py` で生成された「出力先」を唯一の正とする。相対パスで明記。

- 事故: 依頼書にDoDがなく“やったつもり”で終わる  
  対策: DoD をチェックリスト化し、最終出力で達成状況を回答させる。

- 事故: テストが無い/増えない  
  対策: 依頼書に「テスト方針」と「追加すべきテスト観点」を必須化。

