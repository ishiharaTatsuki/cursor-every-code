---
description: hooks
alwaysApply: true
globs:
  - "**/*"
---

# Hooks System (Cursor third-party hooks)

This repo uses **Claude Code-style hooks** via `./.claude/settings.json` so it can run in Cursor when "third-party hooks" are enabled.

## Event semantics (important)

- **PreToolUse**: runs *before* a tool executes (good for blocking dangerous commands).
- **PostToolUse**: runs *after* a tool executes (good for auto-format / lightweight checks).
- **Stop**: runs when the main agent **finishes a response** (NOT session end).
- **SessionEnd**: runs when the **session ends**.

## Current hooks (./.claude/settings.json)

### PreToolUse

For `Bash`:

- **bash-danger-guard.js** (BLOCK): blocks high-confidence destructive commands (rm -rf /, sudo, curl|sh, mkfs, dd, shutdown).
- **tmux-reminder.js** (WARN): suggests tmux/screen for long-ish commands (throttled).
- **dev-server-guard.js** (WARN/BLOCK optional): warns on dev servers; can block if `ECC_REQUIRE_TMUX_FOR_DEV_SERVER=1`.
- **git-push-reminder.js** (WARN/BLOCK optional): reminds before `git push`; can block force pushes with `ECC_BLOCK_FORCE_PUSH=1`.
- **suggest-compact.js** (WARN): suggests `/compact` after many tool calls (threshold + interval).

For `Write|Edit|MultiEdit`:

- **doc-file-guard.js** (OFF by default): warn/block on writing `.md/.txt` (except README/CHANGELOG). Controlled by `ECC_DOC_GUARD=off|warn|block`.
- **suggest-compact.js** (WARN)

### PostToolUse

For `Write|Edit|MultiEdit`:

- **python-after-edit.js** (best-effort): runs `ruff format` and `ruff check` if available.
- **js-after-edit.js** (best-effort): runs Prettier if available locally (never installs by default), optional `tsc --noEmit`.

For `Bash`:

- **gh-pr-status.js** (optional): detects PR URLs and hints `gh pr view`; actual `gh pr view` is opt-in via `ECC_GH_PR_STATUS=1`.

### SessionEnd

- **session-end.js**: writes session artifacts.
- **evaluate-session.js**: writes session metadata for continuous learning (suggests running `/learn`).
- **python-stop-checks.js**: runs deeper checks at session end (pytest/mypy if configured).

### Stop

- **check-console-log.js**: lightweight warning for `console.log`/`debugger` in modified JS/TS files.

## Design guidelines

- Prefer **blocking** only for “high confidence dangerous” actions.
- Keep **Stop** hooks lightweight (they run often).
- Never rely on SessionEnd output to “tell the model”; treat SessionEnd as side-effect-only (files/logs).
