---
description: testing
alwaysApply: true
globs:
  - "**/*"
---

# Testing

## Coverage target

- **Aim** for ~80%+ on core business logic, but don’t game coverage.
- Prioritize testing **high-risk** and **high-change** areas.

## Test types

Choose the smallest test that gives confidence:

1. **Unit tests** — pure logic, utilities, small modules
2. **Integration tests** — boundaries (DB, filesystem, HTTP clients), adapters
3. **E2E tests** — only for critical user flows / high-value paths

## TDD (recommended)

1. Write a failing test (RED)
2. Make it pass with minimal code (GREEN)
3. Refactor (keep tests green)

## Python defaults

- Unit/integration: `pytest`
- Coverage: `pytest --cov` (coverage.py)
- Optional typing: `mypy` or `pyright`

## JS/TS defaults (if present)

- Unit/integration: `vitest` / `jest`
- E2E: Playwright

## Troubleshooting failures

- Verify test isolation (no shared mutable state)
- Fix implementation first; change tests only when the test was wrong
- Reproduce with the smallest command and smallest failing test
